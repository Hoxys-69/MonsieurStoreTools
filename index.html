<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guide Volets Roulants</title>
  <link rel="manifest" href="manifest.json">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js").catch(e => console.warn("SW register failed:", e));
    }
  </script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; color: #333; }
    header { background: #ff6600; color: white; padding: 15px; text-align: center; }
    h1 { margin: 0; font-size: 22px; }
    .container { padding: 20px; }
    .menu { background: white; margin: 10px 0; padding: 15px; border-radius: 8px;
           box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; transition: background 0.2s; }
    .menu:hover { background: #ffe5cc; }
    .back { display: inline-block; margin-bottom: 15px; padding: 8px 12px; background: #666; color: white;
           border-radius: 5px; text-decoration: none; cursor: pointer; }
    ol li { margin-bottom: 8px; }
  </style>
</head>
<body>
  <header><h1>⚙️ Guide Volets Roulants</h1></header>
  <div class="container" id="content"></div>

  <script src="data.js"></script>
  <script>
    const content = document.getElementById("content");

    if (typeof data === "undefined") {
      content.innerHTML = '<div class="menu">Erreur : fichier <code>data.js</code> introuvable ou mal chargé.</div>';
      console.error("data.js non chargé ou variable `data` manquante.");
      throw new Error("data.js non chargé");
    }

    const marques = [...new Set(data.map(item => item.marque))];

    function createBackButton(onClick) {
      const back = document.createElement("div");
      back.className = "back";
      back.textContent = "← Retour";
      back.addEventListener("click", onClick);
      return back;
    }

    function showMarques() {
      content.innerHTML = "";
      marques.forEach(marque => {
        const div = document.createElement("div");
        div.className = "menu";
        div.textContent = marque;
        div.addEventListener("click", () => showModeles(marque));
        content.appendChild(div);
      });
    }

    function showModeles(marque) {
      content.innerHTML = "";
      content.appendChild(createBackButton(showMarques));
      const modeles = data.filter(item => item.marque === marque);
      modeles.forEach(modele => {
        const div = document.createElement("div");
        div.className = "menu";
        div.textContent = modele.modele;
        div.addEventListener("click", () => showGuides(modele));
        content.appendChild(div);
      });
    }

    function showGuides(modele) {
      content.innerHTML = "";
      content.appendChild(createBackButton(() => showModeles(modele.marque)));
      if (!Array.isArray(modele.guides) || modele.guides.length === 0) {
        const msg = document.createElement("div");
        msg.className = "menu";
        msg.textContent = "Aucun guide disponible pour ce modèle.";
        content.appendChild(msg);
        return;
      }
      modele.guides.forEach(guide => {
        const div = document.createElement("div");
        div.className = "menu";
        div.textContent = guide.titre;
        div.addEventListener("click", () => showGuideDetail(modele, guide));
        content.appendChild(div);
      });
    }

    function showGuideDetail(modele, guide) {
      content.innerHTML = "";
      content.appendChild(createBackButton(() => showGuides(modele)));
      const div = document.createElement("div");
      div.className = "menu";

      const h2 = document.createElement("h2");
      h2.textContent = `${modele.marque} - ${modele.modele}`;
      div.appendChild(h2);

      const h3 = document.createElement("h3");
      h3.textContent = guide.titre;
      div.appendChild(h3);

      const ol = document.createElement("ol");
      (guide.etapes || []).forEach(e => {
        const li = document.createElement("li");
        li.textContent = e;
        ol.appendChild(li);
      });
      div.appendChild(ol);

      content.appendChild(div);
    }

    showMarques();
  </script>
</body>
</html>